@import '@radix-ui/colors/black-alpha.css';
@import '@radix-ui/colors/mauve.css';
@import '@radix-ui/colors/red.css';
@import '@radix-ui/colors/violet.css';
@import 'katex/dist/katex.min.css';
@import '../node_modules/mathlive/mathlive-static.css';
@import '../node_modules/mathlive/mathlive-fonts.css';

/* Ensure KaTeX matches surrounding text sizing without overriding KaTeX's own vertical metrics. */
.katex,
.katex-display,
.katex-inline {
  font-size: 1em;
}

/* Display equations should behave like normal block content in text flow. */
.katex-display {
  display: block;
  margin: 0.5em 0;
  max-width: 100%;
}

/* KaTeX inline math should behave like normal inline content. */
.katex-inline {
  display: inline;
  max-width: 100%;
}

@layer base {
  :root {
    --tk-katex-inline-baseline-shift: -0.08em;
  }
}

.tk-katex-wrapper {
  font-size: 1em;
}

/* Inline equations can look slightly raised when surrounding text uses a different font.
   Nudge them down very slightly while keeping display equations unaffected. */
.tk-katex-wrapper:not(.block) {
  vertical-align: var(--tk-katex-inline-baseline-shift);
  align-items: baseline;
}

.tk-katex-wrapper .katex {
  vertical-align: baseline;
}

.katex,
.katex-display,
.katex-inline {
  overflow: visible;
}

/* Responsive math containers (used by <Katex />) */
.tk-math-block {
  display: block;
  width: 100%;
  max-width: 100%;
  text-align: center;
}

.tk-math-inline {
  display: inline;
  max-width: 100%;
  line-height: 1.25;
  overflow: visible;
}

.tk-math-fit {
  display: inline-block;
  max-width: 100%;
  min-width: 0;
  transform-origin: center left;
}

.tk-math-block .tk-math-fit {
  transform-origin: center;
}

/*
  Tailwind Typography (.prose) applies line-height and font rules to all descendants.
  KaTeX relies on its own internal metrics; leaking line-height into KaTeX causes
  inconsistent operator spacing and exponent alignment.
*/
.prose .katex,
.prose .katex * {
  line-height: normal;
  letter-spacing: normal;
  word-spacing: normal;
}

.tk-question-editor .prose .katex,
.tk-question-editor .prose .katex *,
.tk-explanation-editor .prose .katex,
.tk-explanation-editor .prose .katex *,
.tk-option-editor .prose .katex,
.tk-option-editor .prose .katex * {
  line-height: normal;
  letter-spacing: normal;
  word-spacing: normal;
}

.tk-math-scroll {
  width: 100%;
  max-width: 100%;
  overflow-x: auto;
  overflow-y: hidden;
  position: relative;
  scrollbar-gutter: stable;
}

 .tk-math-scroll-inline {
   display: inline-block;
   width: auto;
   max-width: 100%;
   overflow-x: auto;
   overflow-y: hidden;
   vertical-align: baseline;
   position: relative;
 }

 .tk-prompt-inline-math {
   line-height: 1.25;
   overflow: visible;
 }

 .tk-prompt-inline-math .katex {
   font-size: 1.08em;
 }

.tk-math-scroll::before,
.tk-math-scroll::after {
  content: '';
  position: sticky;
  top: 0;
  width: 24px;
  height: 100%;
  pointer-events: none;
  z-index: 1;
}

.tk-math-scroll::before {
  left: 0;
  background: linear-gradient(to right, hsl(var(--background)) 0%, hsl(var(--background) / 0) 100%);
}

 .tk-frac {
   display: inline-flex;
   flex-direction: column;
   align-items: center;
   justify-content: center;
   vertical-align: middle;
   line-height: 1;
   padding: 0 0.08em;
 }

 .tk-frac-num,
 .tk-frac-den {
   font-size: 0.85em;
   line-height: 1;
 }

 .tk-frac-bar {
   width: 100%;
   height: 1px;
   background: currentColor;
   opacity: 0.9;
   margin: 0.06em 0;
 }

.tk-math-scroll::after {
  right: 0;
  background: linear-gradient(to left, hsl(var(--background)) 0%, hsl(var(--background) / 0) 100%);
}

/* Allow long expressions to shrink naturally on small screens rather than wrap symbol-by-symbol. */
.katex-display > .katex {
  max-width: 100%;
}

@tailwind base;
@tailwind components;
@tailwind utilities;

/* Inline blank rectangles used for Fill in the Blanks questions */
.tk-blank {
  display: inline-block;
  padding: 0.1rem 0.4rem;
  margin: 0 0.1rem;
  border-radius: 0.25rem;
  border: 1px solid rgba(15, 23, 42, 0.2);
  background-color: rgba(148, 163, 184, 0.1);
}

/* Styles for TypingAnswerMathInput scripts (sup/sub) */
.tk-script {
  display: inline-flex;
  align-items: baseline;
}

.tk-script .tk-sup {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 1;
}

.tk-script .tk-sub {
  font-size: 0.75em;
  vertical-align: sub;
  line-height: 1;
}

/* Definition of the design system. All colors, gradients, fonts, etc should be defined here. 
All colors MUST be HSL.
*/

 /* Local font faces (place font files in public/fonts) */
 @font-face {
   font-family: 'Roboto Slab';
   src: url('/Roboto Slab.ttf') format('truetype');
   font-weight: 100 900;
   font-style: normal;
   font-display: swap;
}

@font-face {
  font-family: 'Lipishree Unicode';
  src: url('/Lipishree%20Unicode.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0980-09FF;
}

@font-face {
  font-family: 'DejanireText';
  src: url('/DejanireText-Italic.ttf') format('truetype');
  font-weight: 400;
  font-style: italic;
  font-display: swap;
}

@font-face {
  font-family: 'KaTeX_Main';
  src: url('/Lipishree%20Unicode.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0980-09FF;
}

@font-face {
  font-family: 'KaTeX_Math';
  src: url('/Lipishree%20Unicode.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
  unicode-range: U+0980-09FF;
}

@font-face {
  font-family: 'Rubik Doodle Shadow';
  src: url('/RubikDoodleShadow-Regular.ttf') format('truetype');
  font-weight: 400;
  font-style: normal;
  font-display: swap;
}

@layer base {
  :root {
    /* Green color scheme matching Instructions and Start buttons */
    --background: 0 0% 100%;
    --foreground: 32 12% 12%;

    --card: 0 0% 100%;
    --card-foreground: 32 12% 12%;

    --popover: 0 0% 100%;
    --popover-foreground: 32 12% 12%;

    /* Primary - green matching bg-green-700 */
    --primary: 94 49% 33%;
    --primary-foreground: 0 0% 100%;
    --primary-hover: 94 49% 28%;
    
    /* Accent - darker green shade */
    --accent: 94 49% 33%;
    --accent-foreground: 0 0% 100%;
    --accent-hover: 94 49% 28%;

    /* Secondary - light green matching bg-green-50 */
    --secondary: 148 35% 96%;
    --secondary-foreground: 32 10% 22%;

    /* Muted - soft green-gray */
    --muted: 148 18% 95%;
    --muted-foreground: 34 8% 44%;

    /* Success - vibrant green */
    --success: 152 60% 40%;
    --success-foreground: 0 0% 100%;

    /* Warning - amber/yellow-green */
    --warning: 38 90% 50%;
    --warning-foreground: 32 12% 12%;

    /* Destructive - red-green (complementary) */
    --destructive: 6 72% 54%;
    --destructive-foreground: 0 0% 100%;

    --border: 148 16% 88%;
    --input: 148 18% 96%;
    --ring: 94 49% 33%;

    --radius: 0.5rem;

    /* Exam mode - deep green */
    --exam-primary: 154 62% 26%;
    --exam-bg: 148 30% 98%;
    
    /* Practice mode - medium green */
    --practice-primary: 152 60% 40%;
    --practice-bg: 148 22% 99%;

    /* Timer colors - green shades */
    --timer-normal: 152 55% 38%;
    --timer-warning: 38 90% 50%;
    --timer-critical: 6 72% 54%;

    /* Accent warm - yellow-green */
    --accent-warm: 72 55% 45%;
    --accent-warm-foreground: 32 12% 12%;

    /* Transitions */
    --transition-base: 200ms ease-in-out;
    --transition-smooth: 300ms cubic-bezier(0.4, 0, 0.2, 1);
  }

  .dark {
    --background: 165 18% 10%;
    --foreground: 40 18% 96%;

    --card: 165 18% 13%;
    --card-foreground: 40 18% 96%;

    --popover: 165 18% 13%;
    --popover-foreground: 40 18% 96%;

    --primary: 94 55% 55%;
    --primary-foreground: 0 0% 100%;
    --primary-hover: 94 55% 48%;

    --accent: 94 55% 55%;
    --accent-foreground: 0 0% 100%;
    --accent-hover: 94 55% 48%;

    --secondary: 155 18% 20%;
    --secondary-foreground: 40 18% 96%;

    --muted: 155 14% 17%;
    --muted-foreground: 38 10% 72%;

    --success: 152 70% 52%;
    --success-foreground: 0 0% 100%;

    --warning: 38 92% 58%;
    --warning-foreground: 165 18% 10%;

    --destructive: 6 76% 60%;
    --destructive-foreground: 0 0% 100%;

    --border: 155 14% 26%;
    --input: 155 14% 20%;
    --ring: 94 55% 55%;

    --exam-primary: 154 72% 44%;
    --exam-bg: 165 18% 11%;
    
    --practice-primary: 152 70% 52%;
    --practice-bg: 165 18% 13%;

    --timer-normal: 152 70% 52%;
    --timer-warning: 38 92% 58%;
    --timer-critical: 6 76% 60%;

    /* Accent warm - yellow-green */
    --accent-warm: 72 62% 58%;
    --accent-warm-foreground: 165 18% 10%;
  }
}

@layer base {
  * {
    @apply border-border;
  }

  html {
    scroll-behavior: smooth;
    height: 100%;
    min-height: 100%;
  }

  body {
    @apply bg-background text-foreground font-sans;
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    height: 100%;
    min-height: 100%;
    overflow-x: hidden;
    overflow-y: auto;
    overscroll-behavior-y: auto;
    margin: 0;
    padding: 0;
  }

  #root {
    height: 100%;
    min-height: 100%;
    display: flex;
    flex-direction: column;
  }

  input:not([type='checkbox']):not([type='radio']):not([type='range']):not([type='color']):not([type='file']),
  textarea,
  select {
    border-radius: calc(var(--radius) + 0.125rem);
    border-width: 1px;
    border-style: solid;
    border-color: hsl(var(--border) / 0.85);
  }

  [data-radix-scroll-area-viewport] {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    overscroll-behavior: contain;
  }

  /* Responsive design - automatically resize for mobile */
  @media (max-width: 768px) {
    body {
      font-size: 14px;
    }
  }
}

/* Hide scrollbars globally but keep scrolling enabled */
* {
  scrollbar-width: none; /* Firefox */
}

*::-webkit-scrollbar {
  width: 0;
  height: 0;
}

@layer components {
  .content-html {
    @apply max-w-full break-words;
    overflow-wrap: anywhere;
    word-break: break-word;
  }

  .tk-logo-font {
    font-family: 'Rubik Doodle Shadow', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont,
      'Segoe UI', Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji';
    font-weight: 400;
  }

  .tk-logo-interactive {
    display: inline-flex;
    align-items: baseline;
    position: relative;
    cursor: pointer;
    user-select: none;
    transform-origin: left center;
    transition: transform 200ms ease, filter 200ms ease;
    animation: tk-logo-float 2.8s ease-in-out infinite;
  }

  .tk-navbar-wordmark {
    letter-spacing: -0.02em;
    line-height: 1;
    display: inline-block;
    padding: 0px;
    background: transparent;
    border: none;
    text-shadow: 0 0 10px rgba(255, 255, 255, 0.18);
    color: inherit;
    filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.14));
    opacity: 0;
    transform: translateY(6px);
    animation: tk-navbar-wordmark-intro 780ms cubic-bezier(0.2, 0.9, 0.2, 1) both;
    will-change: opacity, transform, filter;
  }

  .tk-navbar-wordmark-letter {
    display: inline-block;
    color: transparent;
    -webkit-background-clip: text;
    background-clip: text;
    background-size: 120% 100%;
    background-position: 50% 0;
    text-shadow: 0 0 12px rgba(255, 255, 255, 0.22);
  }

  .tk-navbar-wordmark-letter:nth-child(1) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(134, 239, 172, 0.98) 38%,
      rgba(34, 211, 238, 0.98) 62%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(2) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(125, 211, 252, 0.98) 38%,
      rgba(45, 212, 191, 0.98) 62%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(3) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(110, 231, 183, 0.98) 38%,
      rgba(250, 204, 21, 0.92) 62%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(4) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(253, 230, 138, 0.96) 36%,
      rgba(52, 211, 153, 0.98) 64%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(5) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(103, 232, 249, 0.98) 38%,
      rgba(167, 243, 208, 0.98) 62%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(6) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(45, 212, 191, 0.98) 38%,
      rgba(129, 140, 248, 0.92) 62%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }
  .tk-navbar-wordmark-letter:nth-child(7) {
    background-image: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.99) 0%,
      rgba(134, 239, 172, 0.98) 36%,
      rgba(253, 230, 138, 0.96) 64%,
      rgba(236, 254, 255, 0.99) 100%
    );
  }

  @keyframes tk-navbar-wordmark-intro {
    from {
      opacity: 0;
      transform: translateY(6px);
      filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0));
    }
    to {
      opacity: 1;
      transform: translateY(0px);
      filter: drop-shadow(0 0 12px rgba(255, 255, 255, 0.14));
    }
  }

  .tk-navbar-wordmark::after {
    content: '';
    position: absolute;
    inset: -10px -14px;
    pointer-events: none;
    background: radial-gradient(closest-side, rgba(255, 255, 255, 0.12), transparent 70%);
    opacity: 0.3;
    filter: blur(10px);
    transform: translateZ(0);
  }

  .tk-navbar-wordmark.tk-logo-interactive {
    animation: tk-navbar-wordmark-intro 780ms cubic-bezier(0.2, 0.9, 0.2, 1) both;
    transition: filter 220ms ease, text-shadow 220ms ease;
  }

  .tk-navbar-wordmark.tk-logo-interactive:hover {
    transform: translateY(0px);
    filter: brightness(1.08) saturate(1.08) drop-shadow(0 0 14px rgba(255, 255, 255, 0.18));
    text-shadow: 0 0 14px rgba(255, 255, 255, 0.24);
  }

  .tk-navbar-wordmark.tk-logo-interactive:hover > .tk-navbar-wordmark-letter {
    filter: brightness(1.06) saturate(1.08);
  }

  .tk-logo-interactive:hover {
    animation-play-state: paused;
    transform: translateY(-1px) scale(1.03);
    filter: drop-shadow(0 14px 24px rgba(0, 0, 0, 0.22));
    text-shadow:
      0 2px 0 rgba(0, 0, 0, 0.22),
      0 3px 14px rgba(0, 0, 0, 0.3),
      0 0 18px rgba(255, 255, 255, 0.12);
  }

  .tk-navbar-wordmark:hover {
    background-position: 40% 0;
  }

  .tk-logo-interactive:hover > span {
    text-shadow: 0 0 14px rgba(255, 255, 255, 0.12);
    animation: tk-logo-letter-jump 900ms cubic-bezier(0.2, 0.9, 0.2, 1.2) both infinite;
  }

  .tk-navbar-wordmark.tk-logo-interactive:hover > .tk-navbar-wordmark-letter {
    text-shadow: 0 0 14px rgba(255, 255, 255, 0.12);
    animation: none;
  }

  /* ... */
  .tk-logo-interactive:hover > span:nth-child(1) {
    --tk-rot: -2deg;
    animation-delay: 0ms;
  }

  .tk-logo-interactive:hover > span:nth-child(2) {
    --tk-rot: 2deg;
    animation-delay: 140ms;
  }

  .tk-logo-interactive:hover > span:nth-child(3) {
    --tk-rot: -1deg;
    animation-delay: 280ms;
  }

  .tk-logo-interactive:hover > span:nth-child(4) {
    --tk-rot: 1deg;
    animation-delay: 420ms;
  }

  .tk-logo-interactive:hover > span:nth-child(5) {
    --tk-rot: -1deg;
    animation-delay: 560ms;
  }

  .tk-logo-interactive:hover > span:nth-child(6) {
    --tk-rot: 1deg;
    animation-delay: 700ms;
  }

  .tk-logo-interactive:hover > span:nth-child(7) {
    --tk-rot: -2deg;
    animation-delay: 840ms;
  }

  .tk-logo-interactive:active {
    animation-play-state: paused;
    transform: translateY(-1px) scale(1.02);
    filter: drop-shadow(0 10px 16px rgba(0, 0, 0, 0.18));
  }

  .tk-app-icon {
    width: 28px;
    height: 28px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    grid-template-rows: 1fr 1fr;
    gap: 2px;
    padding: 0px;
    border-radius: 4px;
    background: transparent;
    border: none;
    box-shadow: none;
    transition: transform 180ms ease;
    will-change: transform;
    overflow: hidden;
    translate: 0 0;
  }

  .tk-app-favicon {
    width: 28px;
    height: 28px;
    border-radius: 0px;
    background: transparent;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.22);
    transition: transform 220ms cubic-bezier(0.2, 0.9, 0.2, 1.2), filter 220ms ease;
    will-change: transform, filter;
    image-rendering: auto;
  }

  .tk-app-favicon:hover {
    transform: translateY(-1px) scale(1.02);
    filter: drop-shadow(0 14px 22px rgba(0, 0, 0, 0.25));
  }

  @media (min-width: 768px) {
    .tk-app-icon {
      width: 32px;
      height: 32px;
    }

    .tk-app-favicon {
      width: 32px;
      height: 32px;
    }
  }

  .tk-app-icon-tile {
    border-radius: 2px;
    box-shadow: none;
    display: grid;
    place-items: center;
    font-weight: 900;
    font-size: 14px;
    line-height: 1;
    color: rgba(15, 23, 42, 0.95);
    transform: translate3d(var(--tk-x, 0px), var(--tk-y, 0px), 0);
    will-change: transform;
    animation: tk-app-icon-intro 520ms cubic-bezier(0.2, 0.9, 0.2, 1.2) both;
  }

  .tk-app-icon-tile-1 {
    background: #22c55e;
    --tk-x: -5px;
    --tk-y: -5px;
    animation-delay: 0ms;
  }
  .tk-app-icon-tile-2 {
    background: #fbbf24;
    --tk-x: 5px;
    --tk-y: -4px;
    animation-delay: 40ms;
  }
  .tk-app-icon-tile-3 {
    background: #ef4444;
    --tk-x: -5px;
    --tk-y: 5px;
    animation-delay: 80ms;
  }
  .tk-app-icon-tile-4 {
    background: #3b82f6;
    --tk-x: 5px;
    --tk-y: 4px;
    animation-delay: 120ms;
  }

  @keyframes tk-app-icon-intro {
    0% {
      transform: translate3d(var(--tk-x, 0px), var(--tk-y, 0px), 0) scale(0.9);
      opacity: 0.8;
    }
    65% {
      transform: translate3d(0px, 0px, 0) scale(1.06);
      opacity: 1;
    }
    100% {
      transform: translate3d(0px, 0px, 0) scale(1);
      opacity: 1;
    }
  }

  @keyframes tk-app-icon-converge {
    0% {
      transform: translate3d(0px, 0px, 0) scale(1);
    }
    45% {
      transform: translate3d(calc(var(--tk-x, 0px) * 0.45), calc(var(--tk-y, 0px) * 0.45), 0) scale(1.05);
    }
    100% {
      transform: translate3d(0px, 0px, 0) scale(1);
    }
  }

  .tk-app-icon:hover {
    transform: translateY(-1px) scale(1.02);
  }

  .tk-app-icon:hover .tk-app-icon-tile {
    animation: tk-app-icon-converge 420ms cubic-bezier(0.2, 0.9, 0.2, 1.2) both;
  }

  @media (prefers-reduced-motion: reduce) {
    .tk-app-icon {
      transition: none;
    }

    .tk-app-icon-tile {
      animation: none;
      transform: none;
    }

    .tk-app-icon:hover .tk-app-icon-tile {
      animation: none;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .tk-logo-interactive {
      animation: none;
      transition: none;
    }

    .tk-logo-interactive > span {
      transition: none;
      animation: none;
    }

    .tk-navbar-wordmark {
      opacity: 1;
      transform: none;
      animation: none;
    }

    .tk-navbar-wordmark::after {
      display: none;
    }
  }

  .tk-wp-expl-text,
  .tk-wp-expl-text *:not(.katex):not(.katex *) {
    font-family: 'Roboto Slab', ui-serif, Georgia, Cambria, 'Times New Roman', Times, serif;
  }

  .tk-bn {
    font-size: 1.12em;
  }

  .tk-question-text,
  .mcq-option-text {
    font-size: 0.9em;
    line-height: 1.55;
  }

  /* Prevent copying in quiz pages */
  .select-none img,
  .select-none .katex,
  .select-none .katex *,
  .select-none .content-html,
  .select-none .content-html * {
    user-select: none !important;
    -webkit-user-select: none !important;
    -moz-user-select: none !important;
    -ms-user-select: none !important;
    -webkit-touch-callout: none !important;
  }

  /* Allow code blocks to be clickable and copyable even in select-none contexts */
  .select-none code,
  .select-none pre {
    user-select: text !important;
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
    pointer-events: auto !important;
  }

  /* Allow input fields and buttons to be selectable/interactive */
  .select-none input,
  .select-none textarea,
  .select-none button {
    user-select: text !important;
    -webkit-user-select: text !important;
    -moz-user-select: text !important;
    -ms-user-select: text !important;
  }

  /* Code block styling with click-to-copy */
  code, pre {
    cursor: pointer;
    position: relative;
    transition: background-color 0.2s ease;
  }

  code:hover, pre:hover {
    background-color: hsl(var(--muted)) !important;
  }

  code::after, pre::after {
    content: 'ðŸ“‹ Click to copy';
    position: absolute;
    top: 0.25rem;
    right: 0.5rem;
    font-size: 0.625rem;
    opacity: 0;
    transition: opacity 0.2s ease;
    pointer-events: none;
    background: hsl(var(--primary));
    color: hsl(var(--primary-foreground));
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    font-weight: 500;
    z-index: 10;
  }

  code:hover::after, pre:hover::after {
    opacity: 1;
  }

  .mcq-option-text,
  .mcq-option-text *:not(.katex):not(.katex *) {
    font-size: inherit !important;
    line-height: inherit !important;
    font-weight: inherit !important;
    font-family: inherit !important;
  }

  .content-html .katex,
  .content-html .katex-display > .katex,
  .content-html .katex-inline > .katex {
    font-size: 1.16em;
    max-width: 100%;
    overflow-wrap: normal;
    word-break: normal;
  }

  .tk-question-text .katex,
  .tk-question-text .katex-display > .katex,
  .tk-question-text .katex-inline > .katex {
    font-size: 1.16em;
    overflow: visible;
    padding-bottom: 0.12em;
  }

  .tk-richtext-editor .katex,
  .tk-richtext-editor .katex-display > .katex,
  .tk-richtext-editor .katex-inline > .katex {
    max-width: 100%;
    overflow-wrap: normal;
    word-break: normal;
  }

  .content-html .katex-display,
  .content-html .katex-inline {
    max-width: 100%;
    overflow: visible;
  }

  .tk-richtext-editor .katex-display,
  .tk-richtext-editor .katex-inline {
    max-width: 100%;
    overflow: visible;
  }

  .content-html .katex-html {
    display: inline !important;
    max-width: 100%;
  }

  .tk-richtext-editor .katex-html {
    display: inline !important;
    max-width: 100%;
  }

  .tk-question-snippet {
    max-width: 100%;
  }

  .tk-question-snippet .katex,
  .tk-question-snippet .katex-display {
    max-width: 100%;
    overflow-x: hidden;
  }

  .content-html .katex-html .base,
  .content-html .katex-html .mord,
  .content-html .katex-html .mop,
  .content-html .katex-html .mbin,
  .content-html .katex-html .mrel,
  .content-html .katex-html .mopen,
  .content-html .katex-html .mclose,
  .content-html .katex-html .mpunct,
  .content-html .katex-html .minner {
    display: inline !important;
    max-width: 100%;
  }

  .tk-richtext-editor .katex-html .base,
  .tk-richtext-editor .katex-html .mord,
  .tk-richtext-editor .katex-html .mop,
  .tk-richtext-editor .katex-html .mbin,
  .tk-richtext-editor .katex-html .mrel,
  .tk-richtext-editor .katex-html .mopen,
  .tk-richtext-editor .katex-html .mclose,
  .tk-richtext-editor .katex-html .mpunct,
  .tk-richtext-editor .katex-html .minner {
    display: inline !important;
    max-width: 100%;
  }

  /* Make images in rendered question/explanation content responsive
     while respecting any saved inline width set by the editor. */
  .content-html img {
    max-width: 100%;
    height: auto;
    display: inline-block;
  }

  .tk-katex-wrapper {
    display: inline-flex;
    align-items: baseline;
    vertical-align: baseline;
    position: relative;
    top: 0;
  }

  .tk-katex-wrapper .katex {
    vertical-align: baseline;
  }

  .katex {
    font-size: 1em;
  }

  .tk-katex-wrapper [data-katex-action] {
    display: none;
  }

  .tk-richtext-editor .tk-katex-wrapper [data-katex-action] {
    display: inline-flex;
  }

  .tk-expr-input {
    font-family: 'DejanireText', ui-serif, Georgia, Cambria, 'Times New Roman', Times, serif;
    font-style: italic;
  }

  math-field.tk-expr-input {
    display: block;
    width: 100%;
    min-height: 40px;
    padding: 0;
    border: 0;
    border-radius: 0;
    background: transparent;
    color: hsl(var(--foreground));
    caret-color: #000 !important;
    --caret-color: #000;
    box-sizing: border-box;
  }

  math-field {
    caret-color: #000 !important;
    --caret-color: #000;
  }

  math-field.tk-expr-input:focus-within {
    outline: none;
    box-shadow: 0 0 0 2px hsl(var(--ring));
  }

  math-field::part(virtual-keyboard-toggle),
  math-field::part(menu-toggle) {
    display: none;
  }

  math-field .ML__virtual-keyboard-toggle,
  math-field .ML__menu-toggle,
  math-field .ML__toggle {
    display: none !important;
  }

  .ML__tooltip,
  .ML__popover,
  .ML__popover-content,
  .ML__popover__content,
  .ML__popover__container,
  .ML__tooltip__content,
  .ML__autocomplete,
  .ML__autocomplete__menu,
  .ML__suggestion,
  .ML__suggestion-panel,
  .ML__suggestions,
  .ML__context-menu,
  .ML__menu,
  .ML__menu-content {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }

  [class^='ML__'][role='tooltip'],
  [class*=' ML__'][role='tooltip'],
  [class^='ML__'][role='menu'],
  [class*=' ML__'][role='menu'],
  [class^='ML__'][role='dialog'],
  [class*=' ML__'][role='dialog'] {
    display: none !important;
    visibility: hidden !important;
    pointer-events: none !important;
  }

  *::selection {
    background: transparent;
    color: inherit;
  }

  *::-moz-selection {
    background: transparent;
    color: inherit;
  }

  .selection-visible::selection {
    background: rgba(59, 130, 246, 0.35);
    color: inherit;
  }

  .selection-visible::-moz-selection {
    background: rgba(59, 130, 246, 0.35);
    color: inherit;
  }

  .is-admin input::selection,
  .is-admin textarea::selection,
  .is-admin [contenteditable='true']::selection,
  .is-admin .ProseMirror::selection,
  .is-admin .ProseMirror *::selection {
    background: rgba(59, 130, 246, 0.35);
    color: inherit;
  }

  .is-admin input::-moz-selection,
  .is-admin textarea::-moz-selection,
  .is-admin [contenteditable='true']::-moz-selection,
  .is-admin .ProseMirror::-moz-selection,
  .is-admin .ProseMirror *::-moz-selection {
    background: rgba(59, 130, 246, 0.35);
    color: inherit;
  }

  /* Visual hint + hit area for the resize "button" in the editor:
     clicking and dragging the bottom-right corner of an image resizes it. */
  .prose img {
    position: relative;
    display: inline-block;
  }

  .prose img::after {
    content: '';
    position: absolute;
    right: -2px;
    bottom: -2px;
    width: 14px;
    height: 14px;
    background-color: hsl(var(--background));
    border: 2px solid hsl(var(--primary));
    box-shadow: 0 0 0 1px hsl(var(--border)), 0 1px 3px rgba(15, 23, 42, 0.25);
    cursor: nwse-resize;
    opacity: 0.95;
    z-index: 1;
  }

  .show-scrollbar {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted-foreground)) hsl(var(--muted));
    scrollbar-gutter: stable;
  }

  .show-scrollbar::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }

  .show-scrollbar::-webkit-scrollbar-track {
    background: hsl(var(--muted));
    border-radius: 999px;
  }

  .show-scrollbar::-webkit-scrollbar-thumb {
    background: hsl(var(--muted-foreground));
    border-radius: 999px;
  }

  .no-user-scroll {
    overscroll-behavior: none;
    touch-action: none;
    scroll-behavior: auto;
  }

  .tk-fade-in {
    animation: tk-fade-slide-up var(--transition-smooth);
  }

  @keyframes tk-fade-slide-up {
    from {
      opacity: 0;
      transform: translateY(8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Larger, more prominent text for question stems */
  .tk-question-editor .prose,
  .tk-question-editor .prose * {
    @apply text-lg leading-relaxed;
  }

  /* Slightly larger text for explanations */
  .tk-explanation-editor .prose,
  .tk-explanation-editor .prose * {
    @apply text-base leading-relaxed;
  }

  /* Larger option text and comfortable line-height */
  .tk-option-editor .prose,
  .tk-option-editor .prose * {
    @apply text-base leading-relaxed;
  }
}
